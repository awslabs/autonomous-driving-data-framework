# DCV-IMAGE Module

## Description
This module builds the DCV image that is runnable in EKS. In particular, the 
DCV image will first install following software:
- AmazonLinux2
- NiceDCV server
- Kubernetes Python Client
- AWSCli

The DCV will also container the following scripts:
- Health Check
- Update ConfigMap and SSM Parameter Store
- DCV Server start up and initialization

In the startup process, DCV image will create a DCV virtual session and open 
port 8443 for traffic to connect. It will accept both TCP traffic (websocket)
and UDP traffic. The authentication will be defined by users using Aws 
SecretManager. Username `dcv-cred-user` and password `dcv-cred-passwd` 
should be established before running this image. During session creation, it 
will create a virtual display where a display socket (X11 socket) will be 
created. In startup process, it will also authorize other applications to 
connect to the display socket.

In updating ConfigMap and SSM Parameter Store, a python script will detect 
the display number generated by DCV server through DCV binary call. The 
display number will be used when running user application pods. Therefore, 
the python script will upload this value to both ConfigMap
`dcv::dcv-agent-config-map` and SSM Parameter Store.

During Health Check, it will check if the DCV virtual session is still valid.
It will report false if the session has been stopped. It will also check if 
the display socket still exists. It will report false if the display socket 
somehow got deleted by other pods.

## Inputs/Outputs

### Input Parameters

#### Required

- `dcv-ecr-repository-name`: Name of the ECR repo to publish dcv image.

#### Optional

None

### Module Metadata Outputs

- `DCVImageUri`: Uri of DCV ECR image

#### Output Example

```json
{
    "DCVImageUri": "<ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/dcv-eks-image:dcv-latest"
}
